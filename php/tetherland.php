<?php

namespace ccxt;

// PLEASE DO NOT EDIT THIS FILE, IT IS GENERATED AND WILL BE OVERWRITTEN:
// https://github.com/ccxt/ccxt/blob/master/CONTRIBUTING.md#how-to-contribute-code

use Exception; // a common import
use ccxt\abstract\tetherland as Exchange;

class tetherland extends Exchange {

    public function describe() {
        return $this->deep_extend(parent::describe(), array(
            'id' => 'tetherland',
            'name' => 'TetherLand',
            'country' => array( 'IR' ),
            'rateLimit' => 1000,
            'version' => '1',
            'certified' => false,
            'pro' => false,
            'has' => array(
                'CORS' => null,
                'spot' => true,
                'margin' => false,
                'swap' => false,
                'future' => false,
                'option' => false,
                'addMargin' => false,
                'cancelAllOrders' => false,
                'cancelOrder' => false,
                'cancelOrders' => false,
                'createDepositAddress' => false,
                'createOrder' => false,
                'createStopLimitOrder' => false,
                'createStopMarketOrder' => false,
                'createStopOrder' => false,
                'editOrder' => false,
                'fetchBalance' => false,
                'fetchBorrowInterest' => false,
                'fetchBorrowRateHistories' => false,
                'fetchBorrowRateHistory' => false,
                'fetchClosedOrders' => false,
                'fetchCrossBorrowRate' => false,
                'fetchCrossBorrowRates' => false,
                'fetchCurrencies' => false,
                'fetchDepositAddress' => false,
                'fetchDeposits' => false,
                'fetchFundingHistory' => false,
                'fetchFundingRate' => false,
                'fetchFundingRateHistory' => false,
                'fetchFundingRates' => false,
                'fetchIndexOHLCV' => false,
                'fetchIsolatedBorrowRate' => false,
                'fetchIsolatedBorrowRates' => false,
                'fetchL2OrderBook' => false,
                'fetchL3OrderBook' => false,
                'fetchLedger' => false,
                'fetchLedgerEntry' => false,
                'fetchLeverageTiers' => false,
                'fetchMarkets' => true,
                'fetchMarkOHLCV' => false,
                'fetchMyTrades' => false,
                'fetchOHLCV' => false,
                'fetchOpenInterestHistory' => false,
                'fetchOpenOrders' => false,
                'fetchOrder' => false,
                'fetchOrderBook' => false,
                'fetchOrders' => false,
                'fetchOrderTrades' => 'emulated',
                'fetchPositions' => false,
                'fetchPremiumIndexOHLCV' => false,
                'fetchTicker' => true,
                'fetchTickers' => true,
                'fetchTime' => false,
                'fetchTrades' => false,
                'fetchTradingFee' => false,
                'fetchTradingFees' => false,
                'fetchWithdrawals' => false,
                'setLeverage' => false,
                'setMarginMode' => false,
                'transfer' => false,
                'withdraw' => false,
            ),
            'comment' => 'This comment is optional',
            'urls' => array(
                'logo' => 'https://cdn.arz.digital/cr-odin/img/exchanges/tetherland/64x64.png',
                'api' => array(
                    'public' => 'https://api.teterlands.com',
                ),
                'www' => 'https://tetherland.org',
                'doc' => array(
                    'https://docs.tetherland.com/docs/tetherland/71ca11f41704f-user-api',
                ),
            ),
            'api' => array(
                'public' => array(
                    'get' => array(
                        'api/v5/currencies' => 1,
                    ),
                ),
            ),
            'fees' => array(
                'trading' => array(
                    'tierBased' => false,
                    'percentage' => true,
                    'maker' => $this->parse_number('0.001'),
                    'taker' => $this->parse_number('0.001'),
                ),
            ),
        ));
    }

    public function fetch_markets(?array $symbols = null, $params = array ()): array {
        /**
         * retrieves data on all $markets for tetherland
         * @see https://docs.tetherland.com/docs/tetherland/71ca11f41704f-user-api
         * @param {array} [$params] extra parameters specific to the exchange API endpoint
         * @return {array[]} an array of objects representing $market data
         */
        $response = $this->publicGetApiV5Currencies ($params);
        $markets = $this->safe_dict($response, 'data');
        $result = array();
        $quotes = array( 'USDT', 'IRT' );
        for ($i = 0; $i < count($markets); $i++) {
            for ($key = 0; $key < count($quotes); $key++) {
                if ($markets[$i]['symbol'] === 'USDT' && $quotes[$key] === 'USDT') {
                    continue;
                }
                $markets[$i]['quote'] = $quotes[$key];
                $market = $this->parse_market($markets[$i]);
                $result[] = $market;
            }
        }
        return $result;
    }

    public function parse_market($market): array {
        // {
        //     'name' => 'Bitcoin',
        //     'fa_name' => 'بیت کوین',
        //     'logo' => '/uploads/images/2022/8/masc3iMjEPBTC.svg',
        //     'accent_color' => '#ff8d00',
        //     'symbol' => 'BTC',
        //     'price' => '69,497.50',
        //     'toman_amount' => 4117726875,
        //     'min_usdt_value' => null,
        //     'min_usdt_amount' => 15,
        //     'max_usdt_amount' => 10000,
        //     'min_value' => null,
        //     'max_amount' => '0.200000000000',
        //     'min_irr_amount' => 883500,
        //     'max_irr_amount' => 589000000,
        //     'priority' => 1,
        //     'price_round_digit' => 2,
        //     'amount_round_digit' => 6,
        //     'changes_24h' => -2.68,
        //     'changes_7d' => 7.522256527082521,
        //     'trendy' => 0,
        //     'exchange' => null,
        //     'categories' => [ ],
        //     'createdAt' => null,
        //     'has_staking' => true,
        //     'staking_plan' => array(
        //         'id' => 38,
        //         'coin_id' => 1,
        //         'periods' => array( '30' => '1.2', '60' => '1.5', 'flex' => '1' ),
        //         'capacity' => '5.00000',
        //         'minimum_staking_amount' => '0.00150',
        //         'maximum_staking_amount' => '1.00000',
        //         'total_staked' => '5.00000',
        //         'largest_benefit' => 1.5,
        //         'trendy' => 0,
        //         'status' => 'COMPLETED',
        //         'info' => 'رمزارز مورد نظر PoS نیست و پاداش حاصل از نگه‌داری آن از طریق دیفای استیکینگ تامین می‌شود.',
        //         'created_at' => '2023-07-15T13:01:25.000000Z',
        //         'updated_at' => '2024-06-01T14:56:40.000000Z',
        //         'deleted_at' => null,
        //         'priority' => 18,
        //     ),
        // }
        list($baseId, $quoteId) = array( $this->safe_string($market, 'symbol'), $this->safe_string($market, 'quote') );
        $base = $this->safe_currency_code($baseId);
        $quote = $this->safe_currency_code($quoteId);
        $id = $base . '/' . $quote;
        $baseId = strtolower($baseId);
        $quoteId = strtolower($quoteId);
        return array(
            'id' => $id,
            'symbol' => $base . '/' . $quote,
            'base' => $base,
            'quote' => $quote,
            'settle' => null,
            'baseId' => $baseId,
            'quoteId' => $quoteId,
            'settleId' => null,
            'type' => 'spot',
            'spot' => true,
            'margin' => false,
            'swap' => false,
            'future' => false,
            'option' => false,
            'active' => true,
            'contract' => false,
            'linear' => null,
            'inverse' => null,
            'contractSize' => null,
            'expiry' => null,
            'expiryDatetime' => null,
            'strike' => null,
            'optionType' => null,
            'precision' => array(
                'amount' => null,
                'price' => null,
            ),
            'limits' => array(
                'leverage' => array(
                    'min' => null,
                    'max' => null,
                ),
                'amount' => array(
                    'min' => null,
                    'max' => null,
                ),
                'price' => array(
                    'min' => null,
                    'max' => null,
                ),
                'cost' => array(
                    'min' => null,
                    'max' => null,
                ),
            ),
            'created' => null,
            'info' => $market,
        );
    }

    public function fetch_tickers(?array $symbols = null, $params = array ()): array {
        /**
         * fetches price tickers for multiple $markets, statistical information calculated over the past 24 hours for each $market
         * @see https://docs.tetherland.com/docs/tetherland/71ca11f41704f-user-api
         * @param {string[]|null} $symbols unified $symbols of the $markets to fetch the ticker for, all $market tickers are returned if not assigned
         * @param {array} [$params] extra parameters specific to the exchange API endpoint
         * @return {array} a dictionary of ~@link https://docs.ccxt.com/#/?id=ticker-structure ticker structures~
         */
        $this->load_markets();
        if ($symbols !== null) {
            $symbols = $this->market_symbols($symbols);
        }
        $response = $this->publicGetApiV5Currencies ($params);
        $markets = $this->safe_dict($response, 'data');
        $result = array();
        $quotes = array( 'USDT', 'IRT' );
        for ($i = 0; $i < count($markets); $i++) {
            for ($key = 0; $key < count($quotes); $key++) {
                if ($markets[$i]['symbol'] === 'USDT' && $quotes[$key] === 'USDT') {
                    continue;
                }
                $markets[$i]['quote'] = $quotes[$key];
                $markets[$i]['id'] = $markets[$i]['symbol'] . '/' . $markets[$i]['quote'];
                $market = $this->parse_ticker($markets[$i]);
                $symbol = $market['symbol'];
                $result[$symbol] = $market;
            }
        }
        return $this->filter_by_array_tickers($result, 'symbol', $symbols);
    }

    public function fetch_ticker(string $symbol, $params = array ()): array {
        /**
         * fetches a price $ticker, a statistical calculation with the information calculated over the past 24 hours for a specific market
         * @see https://docs.tetherland.com/docs/tetherland/71ca11f41704f-user-api
         * @param {string} $symbol unified $symbol of the market to fetch the $ticker for
         * @param {array} [$params] extra parameters specific to the exchange API endpoint
         * @return {array} a ~@link https://docs.ccxt.com/#/?id=$ticker-structure $ticker structure~
         */
        $ticker = $this->fetch_tickers(array( $symbol ));
        return $ticker[$symbol];
    }

    public function parse_ticker($ticker, ?array $market = null): array {
        // {
        //     'name' => 'Bitcoin',
        //     'fa_name' => 'بیت کوین',
        //     'logo' => '/uploads/images/2022/8/masc3iMjEPBTC.svg',
        //     'accent_color' => '#ff8d00',
        //     'symbol' => 'BTC',
        //     'price' => '69,497.50',
        //     'toman_amount' => 4117726875,
        //     'min_usdt_value' => null,
        //     'min_usdt_amount' => 15,
        //     'max_usdt_amount' => 10000,
        //     'min_value' => null,
        //     'max_amount' => '0.200000000000',
        //     'min_irr_amount' => 883500,
        //     'max_irr_amount' => 589000000,
        //     'priority' => 1,
        //     'price_round_digit' => 2,
        //     'amount_round_digit' => 6,
        //     'changes_24h' => -2.68,
        //     'changes_7d' => 7.522256527082521,
        //     'trendy' => 0,
        //     'exchange' => null,
        //     'categories' => [ ],
        //     'createdAt' => null,
        //     'has_staking' => true,
        //     'staking_plan' => array(
        //         'id' => 38,
        //         'coin_id' => 1,
        //         'periods' => array( '30' => '1.2', '60' => '1.5', 'flex' => '1' ),
        //         'capacity' => '5.00000',
        //         'minimum_staking_amount' => '0.00150',
        //         'maximum_staking_amount' => '1.00000',
        //         'total_staked' => '5.00000',
        //         'largest_benefit' => 1.5,
        //         'trendy' => 0,
        //         'status' => 'COMPLETED',
        //         'info' => 'رمزارز مورد نظر PoS نیست و پاداش حاصل از نگه‌داری آن از طریق دیفای استیکینگ تامین می‌شود.',
        //         'created_at' => '2023-07-15T13:01:25.000000Z',
        //         'updated_at' => '2024-06-01T14:56:40.000000Z',
        //         'deleted_at' => null,
        //         'priority' => 18,
        //     ),
        // }
        $marketType = 'otc';
        $marketId = $this->safe_string($ticker, 'id');
        $quote = $this->safe_string($ticker, 'quote');
        $symbol = $this->safe_symbol($marketId, $market, null, $marketType);
        $last = $this->safe_float($ticker, 'price', 0);
        if ($quote === 'IRT') {
            $last = $this->safe_float($ticker, 'toman_amount', 0);
        }
        $change = $this->safe_float($ticker, 'changes_24h', 0);
        return $this->safe_ticker(array(
            'symbol' => $symbol,
            'timestamp' => null,
            'datetime' => null,
            'high' => null,
            'low' => null,
            'bid' => null,
            'bidVolume' => null,
            'ask' => null,
            'askVolume' => null,
            'vwap' => null,
            'open' => null,
            'close' => $last,
            'last' => $last,
            'previousClose' => null,
            'change' => $change,
            'percentage' => null,
            'average' => null,
            'baseVolume' => null,
            'quoteVolume' => null,
            'info' => $ticker,
        ), $market);
    }

    public function sign($path, $api = 'public', $method = 'GET', $params = array (), $headers = null, $body = null) {
        $url = $this->urls['api']['public'] . '/' . $path;
        $headers = array( 'Content-Type' => 'application/json' );
        return array( 'url' => $url, 'method' => $method, 'body' => $body, 'headers' => $headers );
    }
}
